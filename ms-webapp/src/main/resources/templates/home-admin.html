<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="app-success" th:content="${success}" th:if="${success}"/>
    <meta name="app-error" th:content="${error}" th:if="${error}"/>
    <title>Administration | KundApp Admin</title>
    <link th:href="@{/css/mdb.min.css}" rel="stylesheet"/>
    <link th:href="@{/css/index.css}" rel="stylesheet"/>
</head>
<body class="admin">
<!-- Admin Navigation -->
<nav class="navbar navbar-expand-lg admin-navbar">
    <div class="container">
        <div class="logo me-3">
            <img th:src="@{/images/kundapplogo.jpg}" alt="KundApp Logo" />
        </div>
        <a class="navbar-brand" href="/admin">KundApp Admin</a>
        <button class="navbar-toggler" type="button" data-mdb-toggle="collapse" data-mdb-target="#navbarMain">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarMain">
            <div class="d-flex align-items-center ms-auto">
                <span class="me-3 admin-user-info" th:if="${user != null}" th:text="${user.email}">admin@kundapp.com</span>
                <form th:action="@{/logout}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-outline-light admin-logout-btn">
                        D√©connexion
                    </button>
                </form>
            </div>
        </div>
    </div>
</nav>

<div class="container py-4">
    <!-- Page Header -->
    <div class="admin-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="admin-title">Administration KundApp</h1>
                <p class="admin-subtitle">Gestion des utilisateurs et du syst√®me</p>
            </div>
        </div>
    </div>

    <!-- Global Search Section -->
    <div class="admin-search-global mb-4" id="searchSection">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <button class="btn btn-sm btn-outline-secondary me-2" id="toggleSearchBtn" onclick="toggleSearchSection()">
                        <span id="searchIcon">‚ñº</span>
                    </button>
                    <h6 class="card-title mb-0">Recherche</h6>
                </div>
                <div class="row" id="searchFields">
                    <div class="col-md-4">
                        <label class="form-label">Pr√©nom</label>
                        <input type="text" class="form-control" id="globalFirstNameSearch"
                               placeholder="Rechercher par pr√©nom..." oninput="filterCurrentTab()">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Nom</label>
                        <input type="text" class="form-control" id="globalLastNameSearch"
                               placeholder="Rechercher par nom..." oninput="filterCurrentTab()">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">&nbsp;</label>
                        <div class="d-block">
                            <button class="btn btn-admin-secondary" style="padding: 12px 24px; font-weight: 600; border-radius: 8px; min-width: 120px;" onclick="clearGlobalSearch()">
                                Effacer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Admin Tabs -->
    <div class="admin-card">
        <!-- Tab Navigation -->
        <ul class="nav nav-tabs admin-tabs" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="teachers-tab" data-mdb-toggle="tab"
                        data-mdb-target="#teachers-content" type="button" role="tab">
                    Teachers
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="users-tab" data-mdb-toggle="tab"
                        data-mdb-target="#users-content" type="button" role="tab">
                    Clients
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sessions-tab" data-mdb-toggle="tab"
                        data-mdb-target="#sessions-content" type="button" role="tab">
                    Sessions
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="adminTabsContent">

            <!-- TEACHERS TAB -->
            <div class="tab-pane fade show active" id="teachers-content" role="tabpanel">
                <div class="admin-card-header" style="background: white; color: var(--admin-primary); padding: 20px; border-bottom: 3px solid white;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="admin-card-title mb-0">Liste des Teachers</h5>
                        <button class="btn btn-admin-primary" style="border: 2px solid white !important;" onclick="openCreateTeacherModal()">
                            Nouveau Teacher
                        </button>
                    </div>
                </div>

                <!-- Teachers Table -->
                <div class="admin-table-container" style="margin-top: 15px; border-radius: 0;">
                    <table class="table admin-table">
                        <thead>
                        <tr>
                            <th>Pr√©nom</th>
                            <th>Nom</th>
                            <th>Email</th>
                            <th>T√©l√©phone</th>
                            <th>Statut</th>
                            <th>Cr√©√© le</th>
                            <th class="text-center">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="teacher : ${users}" th:if="${teacher.role.name() == 'TEACHER'}" class="admin-table-row teacher-row">
                            <td th:text="${teacher.firstName}">Marie</td>
                            <td th:text="${teacher.lastName}">Martin</td>
                            <td><span class="admin-email" th:text="${teacher.email}">marie@example.com</span></td>
                            <td th:text="${teacher.phoneNumber != null ? teacher.phoneNumber : '-'}">06 12 34 56 78</td>
                            <td>
                                <span th:class="${teacher.status} ? 'admin-status admin-status-active' : 'admin-status admin-status-inactive'">
                                    <span th:text="${teacher.status} ? 'Actif' : 'Inactif'">Actif</span>
                                </span>
                            </td>
                            <td th:text="${#temporals.format(teacher.createdAt, 'dd/MM/yyyy')}">01/01/2025</td>
                            <td class="text-center admin-actions">
                                <div class="admin-action-buttons">
                                    <button class="btn btn-admin-edit" th:onclick="|openEditTeacherModal(${teacher.id})|" title="Modifier">
                                        Modifier
                                    </button>
                                    <button th:if="${teacher.status}" class="btn btn-admin-disable" th:onclick="|confirmDisableTeacher(${teacher.id})|" title="D√©sactiver">
                                        D√©sactiver
                                    </button>
                                    <button th:unless="${teacher.status}" class="btn btn-admin-enable" th:onclick="|confirmEnableTeacher(${teacher.id})|" title="Activer">
                                        Activer
                                    </button>
                                    <button class="btn btn-admin-delete" th:onclick="|confirmDeleteTeacher(${teacher.id})|" title="Supprimer">
                                        Supprimer
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <!-- Empty state pour teachers -->
                        <tr th:if="${users == null || users.isEmpty()}" class="admin-empty-state">
                            <td colspan="7" class="text-center py-5">
                                <div class="admin-empty-content">
                                    <h5 class="admin-empty-title">Aucun teacher trouv√©</h5>
                                    <p class="admin-empty-text">Cr√©er un teacher</p>
                                    <button class="btn btn-admin-primary" style="border: 2px solid white !important;" onclick="openCreateTeacherModal()">
                                        Cr√©er un teacher
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- USERS TAB -->
            <div class="tab-pane fade" id="users-content" role="tabpanel">
                <div class="admin-card-header" style="background: white; color: var(--admin-primary); padding: 20px; border-bottom: 3px solid white;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="admin-card-title mb-0">Liste des Clients</h5>
                        <button class="btn btn-admin-primary" style="border: 2px solid white !important;" onclick="openCreateUserModal()">
                            Nouveau Client
                        </button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="admin-table-container" style="margin-top: 15px; border-radius: 0;">
                    <table class="table admin-table">
                        <thead>
                        <tr>
                            <th>Pr√©nom</th>
                            <th>Nom</th>
                            <th>Email</th>
                            <th>Statut</th>
                            <th>Cr√©dits</th>
                            <th>Cr√©√© le</th>
                            <th class="text-center">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="user : ${users}" th:if="${user.role.name() == 'CLIENT'}" class="admin-table-row user-row">
                            <td th:text="${user.firstName}">John</td>
                            <td th:text="${user.lastName}">Doe</td>
                            <td><span class="admin-email" th:text="${user.email}">john@example.com</span></td>
                            <td>
                                <span th:class="${user.status} ? 'admin-status admin-status-active' : 'admin-status admin-status-inactive'">
                                    <span th:text="${user.status} ? 'Actif' : 'Inactif'">Actif</span>
                                </span>
                            </td>
                            <td th:text="${user.credits != null ? user.credits : '0'}">5</td>
                            <td th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}">01/01/2025</td>
                            <td class="text-center admin-actions">
                                <div class="admin-action-buttons">
                                    <button class="btn btn-admin-edit" th:onclick="|openEditUserModal(${user.id})|" title="Modifier">
                                        Modifier
                                    </button>
                                    <button class="btn btn-outline-info btn-sm" th:onclick="|openCreditsModal(${user.id})|" title="G√©rer cr√©dits">
                                        Cr√©dits
                                    </button>
                                    <button th:if="${user.status}" class="btn btn-admin-disable" th:onclick="|confirmDisableUser(${user.id})|" title="D√©sactiver">
                                        D√©sactiver
                                    </button>
                                    <button th:unless="${user.status}" class="btn btn-admin-enable" th:onclick="|confirmEnableUser(${user.id})|" title="Activer">
                                        Activer
                                    </button>
                                    <button class="btn btn-admin-delete" th:onclick="|confirmDeleteUser(${user.id})|" title="Supprimer">
                                        Supprimer
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <!-- Empty state pour users -->
                        <tr th:if="${users == null || users.isEmpty()}" class="admin-empty-state">
                            <td colspan="7" class="text-center py-5">
                                <div class="admin-empty-content">
                                    <h5 class="admin-empty-title">Aucun client trouv√©</h5>
                                    <p class="admin-empty-text">Cr√©er votre premier client</p>
                                    <button class="btn btn-admin-primary" style="border: 2px solid white !important;" onclick="openCreateUserModal()">
                                        Cr√©er un client
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- SESSIONS TAB - Version corrig√©e sans propri√©t√©s manquantes -->
            <div class="tab-pane fade" id="sessions-content" role="tabpanel">
                <div class="admin-card-header" style="background: white; color: var(--admin-primary); padding: 20px; border-bottom: 3px solid white;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="admin-card-title mb-0">Liste des Sessions</h5>
                    </div>
                </div>

                <!-- Sessions Table -->
                <div class="admin-table-container" style="margin-top: 15px; border-radius: 0;">
                    <table class="table admin-table">
                        <thead>
                        <tr>
                            <th>Date/Heure</th>
                            <th>Lieu</th>
                            <th>Teacher</th>
                            <th>Sujet</th>
                            <th>Statut</th>
                            <th>Participants</th>
                            <th class="text-center">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="sessionItem : ${sessions}" th:if="${sessions != null}" class="admin-table-row session-row">
                            <td th:text="${sessionItem.session.startDateTime}">01/01/2025 14:00</td>
                            <td>
                                <div th:text="${sessionItem.session.roomName}">Studio Yoga</div>
                                <small class="text-muted" th:text="${sessionItem.session.postalCode}">75001</small>
                            </td>
                            <td>
                                <span th:text="${sessionItem.teacherFirstName + ' ' + sessionItem.teacherLastName}" class="teacher-name">Marie Martin</span>
                            </td>
                            <td th:text="${sessionItem.session.subject}">YOGA</td>
                            <td>
                                <span th:if="${sessionItem.session.status.name() == 'SCHEDULED'}" class="admin-status admin-status-active">
                                    Programm√©e
                                </span>
                                <span th:if="${sessionItem.session.status.name() == 'CANCELLED'}" class="admin-status admin-status-inactive">
                                    Annul√©e
                                </span>
                                <span th:if="${sessionItem.session.status.name() == 'COMPLETED'}" class="admin-status admin-status-completed">
                                    Termin√©e
                                </span>
                            </td>
                            <td>
                                <span th:text="${sessionItem.session.registeredParticipants ?: 0}">5</span> participants
                                <button class="btn btn-sm btn-outline-info ms-2"
                                        th:onclick="|showParticipants(${sessionItem.session.id})|"
                                        title="Voir les participants">
                                    üë•
                                </button>
                            </td>

                            <td class="text-center admin-actions">
                                <div class="admin-action-buttons">
                                    <button class="btn btn-admin-edit" th:onclick="|openEditSessionModal(${sessionItem.session.id})|" title="Modifier">
                                        Modifier
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <!-- Empty state -->
                        <tr th:if="${sessions == null || sessions.isEmpty()}" class="admin-empty-state">
                            <td colspan="6" class="text-center py-5">
                                <div class="admin-empty-content">
                                    <h5 class="admin-empty-title">Aucune session trouv√©e</h5>
                                    <p class="admin-empty-text">Les sessions cr√©√©es par les teachers appara√Ætront ici</p>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Teacher Modal -->
<div class="modal fade" id="teacherModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="teacherModalTitle">Cr√©er un Teacher</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <form id="teacherForm" action="/admin/teachers" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" id="teacherId" name="id">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherFirstName" class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="teacherFirstName" name="firstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherLastName" class="form-label">Nom *</label>
                            <input type="text" class="form-control" id="teacherLastName" name="lastName" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherEmail" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="teacherEmail" name="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherPhone" class="form-label">T√©l√©phone</label>
                            <input type="tel" class="form-control" id="teacherPhone" name="phoneNumber">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherPassword" class="form-label">Mot de passe *</label>
                            <input type="password" class="form-control" id="teacherPassword" name="password" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherBirthDate" class="form-label">Date de naissance</label>
                            <input type="date" class="form-control" id="teacherBirthDate" name="dateOfBirth">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="teacherBiography" class="form-label">Biographie</label>
                        <textarea class="form-control" id="teacherBiography" name="biography" rows="3"></textarea>
                    </div>

                    <!-- Section Adresse -->
                    <hr>
                    <h6 class="mb-3">Adresse</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherStreet" class="form-label">Rue</label>
                            <input type="text" class="form-control" id="teacherStreet" name="address.street">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherCity" class="form-label">Ville</label>
                            <input type="text" class="form-control" id="teacherCity" name="address.city">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherZipCode" class="form-label">Code postal</label>
                            <input type="text" class="form-control" id="teacherZipCode" name="address.zipCode">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherCountry" class="form-label">Pays</label>
                            <input type="text" class="form-control" id="teacherCountry" name="address.country">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Teacher Update Modal - Modification SANS password -->
<div class="modal fade" id="teacherUpdateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modifier le Teacher</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <form id="teacherUpdateForm" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" id="teacherUpdateId" name="id">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateFirstName" class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="teacherUpdateFirstName" name="firstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateLastName" class="form-label">Nom *</label>
                            <input type="text" class="form-control" id="teacherUpdateLastName" name="lastName" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateEmail" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="teacherUpdateEmail" name="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdatePhone" class="form-label">T√©l√©phone</label>
                            <input type="tel" class="form-control" id="teacherUpdatePhone" name="phoneNumber">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateBirthDate" class="form-label">Date de naissance</label>
                            <input type="date" class="form-control" id="teacherUpdateBirthDate" name="dateOfBirth">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="teacherUpdateBiography" class="form-label">Biographie</label>
                        <textarea class="form-control" id="teacherUpdateBiography" name="biography" rows="3"></textarea>
                    </div>

                    <!-- Section Adresse -->
                    <hr>
                    <h6 class="mb-3">Adresse</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateStreet" class="form-label">Rue</label>
                            <input type="text" class="form-control" id="teacherUpdateStreet" name="address.street">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateCity" class="form-label">Ville</label>
                            <input type="text" class="form-control" id="teacherUpdateCity" name="address.city">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateZipCode" class="form-label">Code postal</label>
                            <input type="text" class="form-control" id="teacherUpdateZipCode" name="address.zipCode">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="teacherUpdateCountry" class="form-label">Pays</label>
                            <input type="text" class="form-control" id="teacherUpdateCountry" name="address.country">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Mettre √† jour</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- User Modal -->
<div class="modal fade" id="userModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalTitle">Cr√©er un Client</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <form id="userForm" action="/admin/users" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" id="userId" name="id">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userFirstName" class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="userFirstName" name="firstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userLastName" class="form-label">Nom *</label>
                            <input type="text" class="form-control" id="userLastName" name="lastName" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userEmail" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="userEmail" name="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userPhone" class="form-label">T√©l√©phone</label>
                            <input type="tel" class="form-control" id="userPhone" name="phoneNumber">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userPassword" class="form-label">Mot de passe *</label>
                            <input type="password" class="form-control" id="userPassword" name="password" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userBirthDate" class="form-label">Date de naissance</label>
                            <input type="date" class="form-control" id="userBirthDate" name="dateOfBirth">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userCredits" class="form-label">Cr√©dits</label>
                            <input type="number" class="form-control" id="userCredits" name="credits" min="0" value="0">
                        </div>
                    </div>
                    <!-- Section Adresse -->
                    <hr>
                    <h6 class="mb-3">Adresse</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userStreet" class="form-label">Rue</label>
                            <input type="text" class="form-control" id="userStreet" name="address.street">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userCity" class="form-label">Ville</label>
                            <input type="text" class="form-control" id="userCity" name="address.city">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userZipCode" class="form-label">Code postal</label>
                            <input type="text" class="form-control" id="userZipCode" name="address.zipCode">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userCountry" class="form-label">Pays</label>
                            <input type="text" class="form-control" id="userCountry" name="address.country">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- User Update Modal - Modification SANS password -->
<div class="modal fade" id="userUpdateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modifier le User</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <form id="userUpdateForm" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" id="userUpdateId" name="id">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateFirstName" class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="userUpdateFirstName" name="firstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateLastName" class="form-label">Nom *</label>
                            <input type="text" class="form-control" id="userUpdateLastName" name="lastName" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateEmail" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="userUpdateEmail" name="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userUpdatePhone" class="form-label">T√©l√©phone</label>
                            <input type="tel" class="form-control" id="userUpdatePhone" name="phoneNumber">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateBirthDate" class="form-label">Date de naissance</label>
                            <input type="date" class="form-control" id="userUpdateBirthDate" name="dateOfBirth">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="userUpdateCredits" class="form-label">Credits</label>
                        <input type="number" class="form-control" id="userUpdateCredits" name="credits">
                    </div>

                    <!-- Section Adresse -->
                    <hr>
                    <h6 class="mb-3">Adresse</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateStreet" class="form-label">Rue</label>
                            <input type="text" class="form-control" id="userUpdateStreet" name="address.street">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateCity" class="form-label">Ville</label>
                            <input type="text" class="form-control" id="userUpdateCity" name="address.city">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateZipCode" class="form-label">Code postal</label>
                            <input type="text" class="form-control" id="userUpdateZipCode" name="address.zipCode">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="userUpdateCountry" class="form-label">Pays</label>
                            <input type="text" class="form-control" id="userUpdateCountry" name="address.country">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Mettre √† jour</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Session Edit Modal -->
<div class="modal fade" id="sessionEditModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modifier la session</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <form id="sessionEditForm" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" id="sessionEditId" name="id">

                    <!-- Sujet (obligatoire) -->
                    <div class="mb-3">
                        <label for="sessionEditSubject" class="form-label">Type de cours *</label>
                        <select class="form-select" id="sessionEditSubject" name="subject" required>
                            <option value="">Choisissez un type de cours...</option>
                            <option value="YOGA">Yoga</option>
                            <option value="KUNDALINI">Kundalini</option>
                            <option value="PILATES">Pilates</option>
                            <option value="SOIN_ENERGETIQUE">Soin √©nerg√©tique</option>
                            <option value="MEDITATION">M√©ditation</option>
                        </select>
                    </div>

                    <!-- Description (obligatoire) -->
                    <div class="mb-3">
                        <label for="sessionEditDescription" class="form-label">Description *</label>
                        <textarea class="form-control" id="sessionEditDescription" name="description"
                                  rows="3" placeholder="D√©crivez cette s√©ance en d√©tail..." required></textarea>
                    </div>

                    <!-- Informations de lieu -->
                    <hr>
                    <h6 class="mb-3">üìç Lieu de la s√©ance</h6>
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="sessionEditRoomName" class="form-label">Nom de la salle/lieu *</label>
                            <input type="text" class="form-control" id="sessionEditRoomName" name="roomName" required
                                   placeholder="Ex: Studio Yoga Paris, Salle A, Parc des Buttes Chaumont...">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="sessionEditPostalCode" class="form-label">Code postal *</label>
                            <input type="text" class="form-control" id="sessionEditPostalCode" name="postalCode"
                                   pattern="^(0[1-9]|[1-8][0-9]|9[0-8])\d{3}$" required
                                   placeholder="75001" maxlength="5">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="sessionEditGoogleMapsLink" class="form-label">Lien Google Maps</label>
                        <input type="url" class="form-control" id="sessionEditGoogleMapsLink" name="googleMapsLink"
                               placeholder="https://maps.app.goo.gl/...">
                        <div class="form-text">Optionnel - Ajoutez un lien Google Maps pour faciliter l'acc√®s</div>
                    </div>

                    <!-- Date et heure -->
                    <hr>
                    <h6 class="mb-3">üïê Date et horaires</h6>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="sessionEditDate" class="form-label">Date *</label>
                            <input type="date" class="form-control" id="sessionEditDate" name="date" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="sessionEditTime" class="form-label">Heure de d√©but *</label>
                            <input type="time" class="form-control" id="sessionEditTime" name="time" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="sessionEditDurationMinutes" class="form-label">Dur√©e (minutes) *</label>
                            <select class="form-select" id="sessionEditDurationMinutes" name="durationMinutes" required>
                                <option value="">Choisir...</option>
                                <option value="15">15 min</option>
                                <option value="30">30 min</option>
                                <option value="45">45 min</option>
                                <option value="60">1h00</option>
                                <option value="75">1h15</option>
                                <option value="90">1h30</option>
                                <option value="105">1h45</option>
                                <option value="120">2h00</option>
                                <option value="150">2h30</option>
                                <option value="180">3h00</option>
                            </select>
                        </div>
                    </div>

                    <!-- Participants et cr√©dits -->
                    <hr>
                    <h6 class="mb-3">üë• Participants et cr√©dits</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="sessionEditAvailableSpots" class="form-label">Nombre de places *</label>
                            <input type="number" class="form-control" id="sessionEditAvailableSpots"
                                   name="availableSpots" min="1" max="50" required>
                            <div class="form-text">Entre 1 et 50 participants</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="sessionEditCreditsRequired" class="form-label">Cr√©dits requis *</label>
                            <input type="number" class="form-control" id="sessionEditCreditsRequired"
                                   name="creditsRequired" min="1" max="10" required>
                            <div class="form-text">Nombre de cr√©dits n√©cessaires pour participer</div>
                        </div>
                    </div>

                    <!-- Mat√©riel -->
                    <hr>
                    <h6 class="mb-3">üßò Mat√©riel</h6>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sessionEditBringYourMattress"
                                   name="bringYourMattress" value="true">
                            <label class="form-check-label" for="sessionEditBringYourMattress">
                                <strong>Les participants doivent apporter leur tapis</strong>
                            </label>
                            <div class="form-text">Cochez si les participants doivent venir avec leur propre √©quipement</div>
                        </div>
                        <!-- Hidden input pour g√©rer le cas o√π la checkbox n'est pas coch√©e -->
                        <input type="hidden" name="bringYourMattress" value="false">
                    </div>

                    <!-- Section participants inscrits (info only) -->
                    <hr>
                    <h6 class="mb-3">üìã Participants inscrits</h6>
                    <div class="alert alert-info" id="sessionEditParticipantsInfo">
                        <div class="d-flex justify-content-between align-items-center">
                            <span id="sessionEditParticipantsCount">0 participant(s) inscrit(s)</span>
                            <button type="button" class="btn btn-sm btn-outline-info" id="sessionEditViewParticipants">
                                Voir la liste
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="me-auto">
                        <!-- Bouton Annuler la session (rouge, √† gauche) -->
                        <button type="button" class="btn btn-danger" id="sessionEditCancelBtn">
                            <i class="fas fa-ban me-1"></i>
                            Annuler cette session
                        </button>
                    </div>
                    <div>
                        <!-- Boutons standards (√† droite) -->
                        <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Fermer</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>
                            Sauvegarder
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Credits Modal -->
<div class="modal fade" id="creditsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Gestion des cr√©dits</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <form id="creditsForm" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" id="creditsUserId" name="userId">
                    <div class="mb-3">
                        <label for="newCredits" class="form-label">Nombre de cr√©dits</label>
                        <input type="number" class="form-control" id="newCredits" name="credits" min="0" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Ajouter</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Participants Modal -->
<div class="modal fade" id="participantsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Participants √† la s√©ance</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="participantsLoading" class="text-center py-3" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                    <p class="mt-2">Chargement des participants...</p>
                </div>
                <div id="participantsContent">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>Pr√©nom</th>
                                <th>Nom</th>
                                <th>Email</th>
                            </tr>
                            </thead>
                            <tbody id="participantsTableBody">
                            <!-- Content will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="participantsEmpty" class="text-center py-4" style="display: none;">
                    <h6>Aucun participant inscrit</h6>
                    <p class="text-muted">Cette s√©ance n'a pas encore de participants inscrits.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>


<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationTitle">Confirmation</h5>
                <button type="button" class="btn-close" data-mdb-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-danger" id="confirmButton">Confirmer</button>
            </div>
        </div>
    </div>
</div>

<footer class="admin-footer">
    <div class="container">
        <p class="text-center mb-0">¬© 2025 KundApp Admin. Tous droits r√©serv√©s.</p>
    </div>
</footer>

<!-- Scripts dans le bon ordre -->
<script th:src="@{/js/common.js?v=1}"></script>
<script th:src="@{/js/admin.js?v=1}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.js"></script>
</body>
</html>